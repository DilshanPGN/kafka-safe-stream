<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kafka UI</title>
</head>
<body>
<h4>Insert Payload:</h4>
<textarea id="payload" spellcheck="false"></textarea>
<button id="produceButton">Produce Payload</button>

<h4>Consumed Messages:</h4>
<textarea id="consumedMessages" spellcheck="false" readonly></textarea>
<button id="consumeButton">Start Consuming</button>
<button id="stopConsumeButton">Stop Consuming</button>
<button id="clearMessages">Clear Messages</button>

<script  type="module">
    const { ipcRenderer } = require('electron');
    const { createKafkaClient, produceMessage, consumeMessages, stopConsuming } = require('./backend/kafka');

    const consumedMessages = document.getElementById('consumedMessages');

    document.getElementById('produceButton').addEventListener('click', async () => {
        const payload = document.getElementById('payload').value;
        try {
            const kafka = await createKafkaClient();
            await produceMessage(kafka, 'alm-kafka-demo-topic', payload);
        } catch (error) {
            console.error(error);
        }
    });

    document.getElementById('stopConsumeButton').addEventListener('click', async () => {
        await stopConsuming();
    });

    document.getElementById('clearMessages').addEventListener('click', () => {
        const consumedMessages = document.getElementById('consumedMessages');
        consumedMessages.value = '';
    });

    document.getElementById('consumeButton').addEventListener('click', async () => {
        try {
            const kafka = await createKafkaClient();
            await consumeMessages(kafka, 'alm-kafka-demo-topic', 'test-group', (message) => {
                consumedMessages.value += message + '\n';
            });
        } catch (error) {
            console.error(error);
        }
    });

</script>
<script src="backend/kafka.js"></script>
</body>
</html>